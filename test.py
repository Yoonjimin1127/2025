import streamlit as st
import matplotlib.pyplot as plt

# -------------------------------
# 1. ì‹ë‹¨ ê· í˜• ë¶„ì„ê¸°
# -------------------------------
food_data = {
    "ê¹€ë°¥": {"ì¹¼ë¡œë¦¬": 300, "íƒ„ìˆ˜í™”ë¬¼": 45, "ë‹¨ë°±ì§ˆ": 8, "ì§€ë°©": 9},
    "ì¹˜í‚¨": {"ì¹¼ë¡œë¦¬": 500, "íƒ„ìˆ˜í™”ë¬¼": 20, "ë‹¨ë°±ì§ˆ": 25, "ì§€ë°©": 30},
    "ìƒëŸ¬ë“œ": {"ì¹¼ë¡œë¦¬": 150, "íƒ„ìˆ˜í™”ë¬¼": 10, "ë‹¨ë°±ì§ˆ": 5, "ì§€ë°©": 7},
    "ë¼ë©´": {"ì¹¼ë¡œë¦¬": 450, "íƒ„ìˆ˜í™”ë¬¼": 65, "ë‹¨ë°±ì§ˆ": 10, "ì§€ë°©": 15},
    "ë–¡ë³¶ì´": {"ì¹¼ë¡œë¦¬": 400, "íƒ„ìˆ˜í™”ë¬¼": 70, "ë‹¨ë°±ì§ˆ": 7, "ì§€ë°©": 10}
}

def diet_balance():
    st.header("ğŸ½ï¸ ì‹ë‹¨ ê· í˜• ë¶„ì„ê¸°")

    menu = st.text_input("ë¨¹ì€ ìŒì‹ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¹€ë°¥, ì¹˜í‚¨, ìƒëŸ¬ë“œ, ë¼ë©´, ë–¡ë³¶ì´)")

    if menu in food_data:
        nutrients = food_data[menu]

        st.subheader(f"'{menu}'ì˜ ì˜ì–‘ ì„±ë¶„")
        st.write(nutrients)

        # ì‹œê°í™”
        fig, ax = plt.subplots()
        labels = ["íƒ„ìˆ˜í™”ë¬¼", "ë‹¨ë°±ì§ˆ", "ì§€ë°©"]
        values = [nutrients["íƒ„ìˆ˜í™”ë¬¼"], nutrients["ë‹¨ë°±ì§ˆ"], nutrients["ì§€ë°©"]]
        ax.pie(values, labels=labels, autopct="%.1f%%", startangle=90)
        st.pyplot(fig)

        # ê°œì„  ì œì•ˆ
        carb, protein, fat = values
        suggestion = ""

        # ê°„ë‹¨ ê¸°ì¤€: íƒ„:ë‹¨:ì§€ = 50:30:20
        if carb > 60:
            suggestion += "- íƒ„ìˆ˜í™”ë¬¼ì´ ë§ì•„ìš”. ì±„ì†Œë‚˜ ë‹¨ë°±ì§ˆì„ ë” ì¶”ê°€í•´ë³´ì„¸ìš”.\n"
        if protein < 15:
            suggestion += "- ë‹¨ë°±ì§ˆì´ ë¶€ì¡±í•´ìš”. ë‹¬ê±€, ë‘ë¶€, ë‹­ê°€ìŠ´ì‚´ì„ ê³ë“¤ì—¬ ë³´ì„¸ìš”.\n"
        if fat > 25:
            suggestion += "- ì§€ë°©ì´ ë§ì•„ìš”. ê¸°ë¦„ì§„ ìŒì‹ì€ ì¡°ê¸ˆ ì¤„ì´ëŠ” ê²Œ ì¢‹ì•„ìš”.\n"

        if suggestion == "":
            suggestion = "ê· í˜• ì¡íŒ ì‹ë‹¨ì´ì—ìš”! ğŸ‘"

        st.subheader("ê°œì„ í•  ì ")
        st.write(suggestion)

    elif menu != "":
        st.warning("ë°ì´í„°ì— ì—†ëŠ” ìŒì‹ì´ì—ìš”. (ì˜ˆ: ê¹€ë°¥, ì¹˜í‚¨, ìƒëŸ¬ë“œ, ë¼ë©´, ë–¡ë³¶ì´)")


# -------------------------------
# 4. ë¹„íƒ€ë¯¼/ë¯¸ë„¤ë„ ì¶”ì²œê¸°
# -------------------------------
nutrient_foods = {
    "ë¹„íƒ€ë¯¼ C": ["ê·¤", "í‚¤ìœ„", "íŒŒí”„ë¦¬ì¹´", "ë¸Œë¡œì½œë¦¬"],
    "ì² ë¶„": ["ì‹œê¸ˆì¹˜", "ì†Œê³ ê¸°", "ì½©", "ê³„ë€"],
    "ì¹¼ìŠ˜": ["ìš°ìœ ", "ì¹˜ì¦ˆ", "ë©¸ì¹˜", "ë‘ë¶€"],
    "ë¹„íƒ€ë¯¼ D": ["ì—°ì–´", "ë²„ì„¯", "ê³„ë€ ë…¸ë¥¸ì"],
    "ì¹¼ë¥¨": ["ë°”ë‚˜ë‚˜", "ê³ êµ¬ë§ˆ", "ì•„ë³´ì¹´ë„"]
}

def vitamin_recommender():
    st.header("ğŸŠ ë¹„íƒ€ë¯¼/ë¯¸ë„¤ë„ ì¶”ì²œê¸°")

    selected = st.selectbox("ë¶€ì¡±í•  ìˆ˜ ìˆëŠ” ì˜ì–‘ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”", list(nutrient_foods.keys()))

    if selected:
        st.subheader(f"âœ… {selected} ë³´ì¶©ì— ì¢‹ì€ ìŒì‹")
        foods = nutrient_foods[selected]
        for f in foods:
            st.write(f"- {f}")


# -------------------------------
# ë©”ì¸ ì‹¤í–‰
# -------------------------------
st.title("ğŸ¥— ì‹í’ˆ ì˜ì–‘ ë¶„ì„ & ì¶”ì²œ ì›¹")

choice = st.sidebar.radio("ë©”ë‰´ ì„ íƒ", ["ì‹ë‹¨ ê· í˜• ë¶„ì„ê¸°", "ë¹„íƒ€ë¯¼/ë¯¸ë„¤ë„ ì¶”ì²œê¸°"])

if choice == "ì‹ë‹¨ ê· í˜• ë¶„ì„ê¸°":
    diet_balance()
else:
    vitamin_recommender()
